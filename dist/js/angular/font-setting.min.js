!function(){"use strict";angular.module("risevision.widget.common.font-setting",["angularLoad","ui.tinymce","risevision.common.i18n","risevision.widget.common.url-field"]).directive("fontSetting",["$templateCache","$log","$window","googleFontLoader",function(t,n,o,a){return{restrict:"AE",scope:{fontData:"=",previewText:"@"},template:t.get("_angular/font-setting/font-setting.html"),transclude:!1,link:function(t,n){function e(){t.tinymceOptions={font_formats:"Use Custom Font=custom;"+WIDGET_SETTINGS_UI_CONFIG.families+t.googleFontList,fontsize_formats:"Custom "+(""!==t.fontData.customSize?t.fontData.customSize+" ":"")+WIDGET_SETTINGS_UI_CONFIG.sizes,menubar:!1,plugins:"textcolor colorpicker",skin_url:"//s3.amazonaws.com/rise-common/styles/tinymce/rise",statusbar:!1,toolbar:"fontselect fontsizeselect | alignleft aligncenter alignright alignjustify | forecolor backcolor | bold italic underline",setup:function(t){t.on("init",function(){i(t),v=!1}),t.on("ExecCommand",function(n){s(t,n)})},init_instance_callback:function(t){var n=t.formatter.apply,o=t.formatter.remove;t.formatter.apply=function(o,a,e){var i={command:o,value:a.value};n(o,a,e),t.fire("ExecCommand",i)},t.formatter.remove=function(n,a,e){var i={command:n,value:a&&a.value?a.value:null};o(n,a,e),t.fire("ExecCommand",i)}}}}function i(n){if(t.fontData){switch("custom"===t.fontData.font.type&&t.fontData.font.url?n.execCommand("FontName",!1,"custom"):n.execCommand("FontName",!1,t.fontData.font.family),n.execCommand("FontSize",!1,t.fontData.size),t.fontData.align){case"left":n.execCommand("JustifyLeft",!1);break;case"center":n.execCommand("JustifyCenter",!1);break;case"right":n.execCommand("JustifyRight",!1);break;case"justify":n.execCommand("JustifyFull",!1)}u.find(".mce-colorbutton[aria-label='Text color'] span").css("background-color",t.fontData.forecolor),u.find(".mce-colorbutton[aria-label='Background color'] span").css("background-color",t.fontData.backcolor),t.fontData.bold&&l(u.find(".mce-btn[aria-label='Bold']")),t.fontData.italic&&l(u.find(".mce-btn[aria-label='Italic']")),t.fontData.underline&&l(u.find(".mce-btn[aria-label='Underline']"))}}function s(n,o){switch(o.command){case"FontName":if(v)return;if("custom"===o.value)return m.modal("show"),void 0;t.fontData.font.family=o.value,t.fontData.font.type=r(o.value);break;case"FontSize":if(v)return;if("Custom"===o.value)return g.modal("show"),void 0;t.fontData.size=o.value;break;case"JustifyLeft":t.fontData.align="left";break;case"JustifyCenter":t.fontData.align="center";break;case"JustifyRight":t.fontData.align="right";break;case"JustifyFull":t.fontData.align="justify";break;case"forecolor":t.fontData.forecolor=o.value?o.value:t.defaultFont.forecolor;break;case"hilitecolor":t.fontData.backcolor=o.value?o.value:t.defaultFont.backcolor;break;case"mceToggleFormat":"bold"===o.value?(t.fontData.bold=!t.fontData.bold,l(u.find(".mce-btn[aria-label='Bold']"))):"italic"===o.value?(t.fontData.italic=!t.fontData.italic,l(u.find(".mce-btn[aria-label='Italic']"))):"underline"===o.value&&(t.fontData.underline=!t.fontData.underline,l(u.find(".mce-btn[aria-label='Underline']")))}c(t.fontData)}function l(t){t.toggleClass("mce-active")}function c(n){var o=u.find(".text-container"),a=u.find(".text");t.previewText&&n&&(a.css("fontFamily",n.font.family),a.css("fontSize",n.size),a.css("fontWeight",n.bold?"bold":"normal"),a.css("fontStyle",n.italic?"italic":"normal"),a.css("textDecoration",n.underline?"underline":"none"),a.css("color",n.forecolor),a.css("backgroundColor",n.backcolor),o.css("textAlign",n.align))}function r(n){return-1!==WIDGET_SETTINGS_UI_CONFIG.families.indexOf(n)?"standard":-1!==t.googleFontList.indexOf(n)?"google":"custom"}function f(){return t.fontData.font.url?t.fontData.font.url.split("/").pop().split(".")[0]:null}function d(n){var o=null,a=$.trim(t.fontData.font.url),e="font-family: "+n+"; src: url('"+a+"');";o=document.styleSheets[0],null!==o&&o.addRule("@font-face",e)}var u=$(n),m=u.find(".custom-font"),g=u.find(".custom-font-size"),v=!0;t.googleFontList="",t.defaultFont={font:{family:"verdana,geneva,sans-serif",type:"standard",url:""},size:"24px",customSize:"",align:"left",bold:!1,italic:!1,underline:!1,forecolor:"black",backcolor:"transparent"},a.getFonts().then(function(n){t.googleFontList=n}),t.customFontSize=null,t.applyCustomFont=function(){var n=f();null!==n&&(d(n),t.fontData.font.family=n,t.fontData.font.type="custom",c(t.fontData)),m.modal("hide")},t.applyCustomFontSize=function(){g.modal("hide"),null!==t.customFontSize&&t.customFontSize>=8&&t.customFontSize+"px"!==t.fontData.size&&(t.fontData.size=t.customFontSize+"px",-1!==WIDGET_SETTINGS_UI_CONFIG.sizes.indexOf(t.fontData.size)||t.fontData.customSize===t.fontData.size?o.tinymce.activeEditor.execCommand("FontSize",!1,t.fontData.size):(t.fontData.customSize=t.customFontSize+"px",t.tinymceOptions.fontsize_formats="Custom "+(""!==t.fontData.customSize?t.fontData.customSize+" ":"")+WIDGET_SETTINGS_UI_CONFIG.sizes)),t.customFontSize=null},t.defaults=function(t){if(t)for(var n=1,o=arguments.length;o>n;n++){var a=arguments[n];for(var e in a)void 0===t[e]&&(t[e]=a[e])}return t};var b=t.$watchGroup(["fontData","googleFontList"],function(n){var o=null,a=n[0],i=n[1];a&&i&&(t.defaults(a,t.defaultFont),t.fontData.font.url&&(o=f(),null!==o&&d(o)),c(a),e(),b(),t.previewText&&t.$watch("fontData",c,!0))});t.$watch("tinymceOptions.fontsize_formats",function(n){"undefined"==typeof n||v||t.$broadcast("$tinymce:refresh")})}}}])}(),function(){"use strict";angular.module("risevision.widget.common.font-setting").factory("googleFontLoader",["$http","angularLoad",function(t,n){var o="https://www.googleapis.com/webfonts/v1/webfonts?key=AIzaSyBXxVK_IOV7LNQMuVVo_l7ZvN53ejN86zY",a="//fonts.googleapis.com/css?family=",e=["Buda","Coda Caption","Open Sans Condensed","UnifrakturCook","Molle"],i=",sans-serif;",s={};return s.getFonts=function(){return t.get(o,{cache:!0}).then(function(t){var o="",s="";if(t.data&&t.data.items)for(var l=0;l<t.data.items.length;l++)o=t.data.items[l].family,-1===e.indexOf(o)&&(n.loadCSS(a+o).then(function(){}),s+=o+"="+o+i);return s})},s}])}(),function(t){try{t=angular.module("risevision.widget.common.font-setting")}catch(n){t=angular.module("risevision.widget.common.font-setting",[])}t.run(["$templateCache",function(t){"use strict";t.put("_angular/font-setting/font-setting.html",'<div class="font-setting">\n  <div class="row">\n    <div class="col-md-12">\n      <textarea ui-tinymce="tinymceOptions" ng-model="tinymceModel" ng-if="tinymceOptions"></textarea>\n    </div>\n  </div>\n  <div class="row" ng-if="previewText">\n    <div class="col-md-12">\n      <div class="text-container form-group">\n        <span class="text">{{previewText}}</span>\n      </div>\n    </div>\n  </div>\n\n  <!-- Custom Font -->\n  <div class="custom-font modal" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="false">\n    <div class="modal-dialog">\n      <div class="modal-content">\n\n        <div class="modal-header">\n          <button type="button" class="close" data-dismiss="modal">\n            <i class="fa fa-times half-top"></i>\n          </button>\n          <h2 class="modal-title">{{"font-setting.custom-font" | translate}}</h2>\n        </div>\n\n        <form role="form" name="customFontForm">\n          <div class="modal-body">\n            <url-field url="fontData.font.url" ng-model="customFont" init-empty></url-field>\n          </div>\n\n          <div class="modal-footer">\n            <button type="button" class="select btn btn-primary btn-fixed-width" ng-click="applyCustomFont()" ng-disabled="customFontForm.$invalid">\n              <span>{{"common.select" | translate}}</span>\n              <i class="fa fa-white fa-check icon-right"></i>\n            </button>\n            <button type="button" class="cancel btn btn-default btn-fixed-width" data-dismiss="modal">\n              <span>{{"common.cancel" | translate}}</span>\n              <i class="fa fa-white fa-times icon-right"></i>\n            </button>\n          </div>\n        </form>\n\n      </div>\n    </div>\n  </div>\n\n  <!-- Custom Font Size -->\n  <div class="custom-font-size modal" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="false">\n    <div class="modal-dialog">\n      <div class="modal-content">\n\n        <div class="modal-header">\n          <button type="button" class="close" data-dismiss="modal">\n            <i class="fa fa-times half-top"></i>\n          </button>\n          <h2 class="modal-title">{{"font-setting.custom-font-size" | translate}}</h2>\n        </div>\n\n        <form role="form" name="customFontSizeForm">\n          <div class="modal-body">\n            <div class="row">\n              <div class="col-md-3">\n                <div class="input-group">\n                  <input type="number" ng-model="customFontSize" class="form-control" />\n                  <span class="input-group-addon">{{\'common.units.pixels\' | translate}}</span>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class="modal-footer">\n            <button type="button" class="select btn btn-primary btn-fixed-width" ng-click="applyCustomFontSize()" ng-disabled="customFontSizeForm.$invalid">\n              <span>{{"common.select" | translate}}</span>\n              <i class="fa fa-white fa-check icon-right"></i>\n            </button>\n            <button type="button" class="cancel btn btn-default btn-fixed-width" data-dismiss="modal">\n              <span>{{"common.cancel" | translate}}</span>\n              <i class="fa fa-white fa-times icon-right"></i>\n            </button>\n          </div>\n        </form>\n\n      </div>\n    </div>\n  </div>\n</div>\n')}])}();