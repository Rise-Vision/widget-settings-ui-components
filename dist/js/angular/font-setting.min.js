!function(){"use strict";angular.module("risevision.widget.common.font-setting",["angularLoad","ui.tinymce","risevision.common.i18n","risevision.widget.common.url-field"]).directive("fontSetting",["$templateCache","$log","googleFontLoader",function(t,n,a){return{restrict:"AE",scope:{fontData:"=",previewText:"@"},template:t.get("_angular/font-setting/font-setting.html"),transclude:!1,link:function(t,n){function o(){t.tinymceOptions={font_formats:WIDGET_SETTINGS_UI_CONFIG.families+g+"Custom=custom;",fontsize_formats:WIDGET_SETTINGS_UI_CONFIG.sizes,menubar:!1,plugins:"textcolor colorpicker",skin_url:"//s3.amazonaws.com/rise-common/styles/tinymce/rise",statusbar:!1,toolbar:"fontselect fontsizeselect | alignleft aligncenter alignright alignjustify | forecolor backcolor | bold italic underline",setup:function(t){t.on("init",function(){e(t),m=!1}),t.on("ExecCommand",function(n){i(t,n)})},init_instance_callback:function(t){var n=t.formatter.apply;t.formatter.apply=function(a,o,e){var i={command:a,value:o.value};n(a,o,e),t.fire("ExecCommand",i)}}}}function e(n){if(t.fontData){switch(t.fontData.font.url?n.execCommand("FontName",!1,"custom"):n.execCommand("FontName",!1,t.fontData.font.family),n.execCommand("FontSize",!1,t.fontData.size),t.fontData.align){case"left":n.execCommand("JustifyLeft",!1);break;case"center":n.execCommand("JustifyCenter",!1);break;case"right":n.execCommand("JustifyRight",!1);break;case"justify":n.execCommand("JustifyFull",!1)}$(".mce-colorbutton[aria-label='Text color'] span").css("background-color",t.fontData.forecolor),$(".mce-colorbutton[aria-label='Background color'] span").css("background-color",t.fontData.backcolor),t.fontData.bold&&l($(".mce-btn[aria-label='Bold']")),t.fontData.italic&&l($(".mce-btn[aria-label='Italic']")),t.fontData.underline&&l($(".mce-btn[aria-label='Underline']"))}}function i(n,a){switch(a.command){case"FontName":if(m)return;if("custom"===a.value)return d.modal("show"),void 0;t.fontData.font.family=a.value,t.fontData.font.type=c(a.value);break;case"FontSize":t.fontData.size=a.value;break;case"JustifyLeft":t.fontData.align="left";break;case"JustifyCenter":t.fontData.align="center";break;case"JustifyRight":t.fontData.align="right";break;case"JustifyFull":t.fontData.align="justify";break;case"forecolor":t.fontData.forecolor=a.value;break;case"hilitecolor":t.fontData.backcolor=a.value;break;case"mceToggleFormat":"bold"===a.value?(t.fontData.bold=!t.fontData.bold,l($(".mce-btn[aria-label='Bold']"))):"italic"===a.value?(t.fontData.italic=!t.fontData.italic,l($(".mce-btn[aria-label='Italic']"))):"underline"===a.value&&(t.fontData.underline=!t.fontData.underline,l($(".mce-btn[aria-label='Underline']")))}s(t.fontData)}function l(t){t.toggleClass("mce-active")}function s(n){var a=document.querySelector(".text-container"),o=document.querySelector(".text");t.previewText&&n&&(o.style.fontFamily=n.font.family,o.style.fontSize=n.size,o.style.fontWeight=n.bold?"bold":"normal",o.style.fontStyle=n.italic?"italic":"normal",o.style.textDecoration=n.underline?"underline":"none",o.style.color=n.forecolor,o.style.backgroundColor=n.backcolor,a.style.textAlign=n.align)}function c(t){return-1!==WIDGET_SETTINGS_UI_CONFIG.families.indexOf(t)?"standard":-1!==g.indexOf(t)?"google":"custom"}function r(){return t.fontData.font.url?t.fontData.font.url.split("/").pop().split(".")[0]:null}function f(n){var a=null,o=$.trim(t.fontData.font.url),e="font-family: "+n+"; src: url('"+o+"');";a=document.styleSheets[0],null!==a&&a.addRule("@font-face",e)}var u=$(n),d=u.find(".custom-font"),m=!0,g="";t.defaultFont={font:{family:"verdana,geneva,sans-serif",type:"standard",url:""},size:"24px",align:"left",bold:!1,italic:!1,underline:!1,forecolor:"black",backcolor:"transparent"},a.getFonts().then(function(t){g=t,o()}),t.applyCustomFont=function(){var n=r();null!==n&&(f(n),t.fontData.font.family=n,t.fontData.font.type="custom",s(t.fontData)),d.modal("hide")},t.defaults=function(t){if(t)for(var n=1,a=arguments.length;a>n;n++){var o=arguments[n];for(var e in o)void 0===t[e]&&(t[e]=o[e])}return t};var b=t.$watch("fontData",function(n){var a=null;n&&(t.defaults(n,t.defaultFont),t.fontData.font.url&&(a=r(),null!==a&&f(a)),s(n),b(),t.previewText&&t.$watch("fontData",s,!0))})}}}])}(),function(){"use strict";angular.module("risevision.widget.common.font-setting").factory("googleFontLoader",["$http","angularLoad",function(t,n){var a="https://www.googleapis.com/webfonts/v1/webfonts?key=AIzaSyBXxVK_IOV7LNQMuVVo_l7ZvN53ejN86zY",o="//fonts.googleapis.com/css?family=",e=["Buda","Coda Caption","Open Sans Condensed","UnifrakturCook","Molle"],i=",sans-serif;",l="",s={};return s.getFonts=function(){return t.get(a,{cache:!0}).then(function(t){var a="";if(t.data&&t.data.items)for(var s=0;s<t.data.items.length;s++)a=t.data.items[s].family,-1===e.indexOf(a)&&(n.loadCSS(o+a).then(function(){}),l+=a+"="+a+i);return l})},s}])}(),function(t){try{t=angular.module("risevision.widget.common.font-setting")}catch(n){t=angular.module("risevision.widget.common.font-setting",[])}t.run(["$templateCache",function(t){"use strict";t.put("_angular/font-setting/font-setting.html",'<div class="font-setting">\n  <div class="row">\n    <div class="col-md-12">\n      <textarea ui-tinymce="tinymceOptions" ng-model="tinymceModel" ng-if="tinymceOptions"></textarea>\n    </div>\n  </div>\n  <div class="row" ng-if="previewText">\n    <div class="col-md-12">\n      <div class="text-container form-group">\n        <span class="text">{{previewText}}</span>\n      </div>\n    </div>\n  </div>\n\n  <!-- Custom Font -->\n  <div class="custom-font modal" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="false">\n    <div class="modal-dialog">\n      <div class="modal-content">\n\n        <div class="modal-header">\n          <button type="button" class="close" data-dismiss="modal">\n            <i class="fa fa-times half-top"></i>\n          </button>\n          <h2 class="modal-title">{{"font-setting.custom-font" | translate}}</h2>\n        </div>\n\n        <form role="form" name="customFontForm">\n          <div class="modal-body">\n            <url-field url="fontData.font.url" ng-model="customFont"></url-field>\n          </div>\n\n          <div class="modal-footer">\n            <button type="button" class="select btn btn-primary btn-fixed-width" ng-click="applyCustomFont()" ng-disabled="customFontForm.$invalid">\n              <span>{{"common.select" | translate}}</span>\n              <i class="fa fa-white fa-check icon-right"></i>\n            </button>\n            <button type="button" class="cancel btn btn-default btn-fixed-width" data-dismiss="modal">\n              <span>{{"common.cancel" | translate}}</span>\n              <i class="fa fa-white fa-times icon-right"></i>\n            </button>\n          </div>\n        </form>\n\n      </div>\n    </div>\n  </div>\n</div>\n')}])}();