!function(){"use strict";angular.module("risevision.widget.common.font-setting",["angularLoad","ui.tinymce","risevision.common.i18n","risevision.widget.common.url-field"]).directive("fontSetting",["$templateCache","$log","$window","googleFontLoader",function(t,n,a,o){return{restrict:"AE",scope:{fontData:"=",previewText:"@",verticalAlign:"@"},template:t.get("_angular/font-setting/font-setting.html"),transclude:!1,link:function(t,n){function e(){t.tinymceOptions={font_formats:"Use Custom Font=custom;"+WIDGET_SETTINGS_UI_CONFIG.families+t.googleFontList,fontsize_formats:"Custom "+(""!==t.fontData.customSize?t.fontData.customSize+" ":"")+WIDGET_SETTINGS_UI_CONFIG.sizes,menubar:!1,plugins:"textcolor colorpicker",skin_url:"//s3.amazonaws.com/rise-common/styles/tinymce/rise",statusbar:!1,toolbar:"fontselect fontsizeselect | alignleft aligncenter alignright alignjustify"+(t.verticalAlign?" aligntop alignmiddle alignbottom":"")+" | forecolor backcolor | bold italic underline",setup:function(n){t.verticalAlign&&d(n),n.on("init",function(){i(n),p=!1}),n.on("ExecCommand",function(t){l(n,t)})},init_instance_callback:function(t){var n=t.formatter.apply,a=t.formatter.remove;t.formatter.apply=function(a,o,e){var i={command:a,value:o.value};n(a,o,e),t.fire("ExecCommand",i)},t.formatter.remove=function(n,o,e){var i={command:n,value:o&&o.value?o.value:null};a(n,o,e),t.fire("ExecCommand",i)}}}}function i(n){if(t.fontData){switch("custom"===t.fontData.font.type&&t.fontData.font.url?n.execCommand("FontName",!1,"custom"):n.execCommand("FontName",!1,t.fontData.font.family),n.execCommand("FontSize",!1,t.fontData.size),t.fontData.align){case"left":n.execCommand("JustifyLeft",!1);break;case"center":n.execCommand("JustifyCenter",!1);break;case"right":n.execCommand("JustifyRight",!1);break;case"justify":n.execCommand("JustifyFull",!1)}t.verticalAlign&&n.execCommand("mceToggleVertical",!1,t.fontData.verticalAlign),g.find(".mce-colorbutton[aria-label='Text color'] span").css("background-color",t.fontData.forecolor),g.find(".mce-colorbutton[aria-label='Background color'] span").css("background-color",t.fontData.backcolor),t.fontData.bold&&s(g.find(".mce-btn[aria-label='Bold']")),t.fontData.italic&&s(g.find(".mce-btn[aria-label='Italic']")),t.fontData.underline&&s(g.find(".mce-btn[aria-label='Underline']"))}}function l(n,a){switch(a.command){case"FontName":if(p)return;if("custom"===a.value)return v.modal("show"),void 0;t.fontData.font.family=a.value,t.fontData.font.type=r(a.value);break;case"FontSize":if(p)return;if("Custom"===a.value)return b.modal("show"),void 0;t.fontData.size=a.value;break;case"JustifyLeft":t.fontData.align="left";break;case"JustifyCenter":t.fontData.align="center";break;case"JustifyRight":t.fontData.align="right";break;case"JustifyFull":t.fontData.align="justify";break;case"mceToggleVertical":a.value?(u(a.value),t.fontData.verticalAlign!==a.value&&u(t.fontData.verticalAlign)):u(t.defaultFont.verticalAlign),t.fontData.verticalAlign=a.value?a.value:t.defaultFont.verticalAlign;break;case"forecolor":t.fontData.forecolor=a.value?a.value:t.defaultFont.forecolor;break;case"hilitecolor":t.fontData.backcolor=a.value?a.value:t.defaultFont.backcolor;break;case"mceToggleFormat":"bold"===a.value?(t.fontData.bold=!t.fontData.bold,s(g.find(".mce-btn[aria-label='Bold']"))):"italic"===a.value?(t.fontData.italic=!t.fontData.italic,s(g.find(".mce-btn[aria-label='Italic']"))):"underline"===a.value&&(t.fontData.underline=!t.fontData.underline,s(g.find(".mce-btn[aria-label='Underline']")))}c(t.fontData)}function s(t){t.toggleClass("mce-active")}function c(n){var a=g.find(".text-container"),o=g.find(".text");t.previewText&&n&&(o.css("fontFamily",n.font.family),o.css("fontSize",n.size),o.css("fontWeight",n.bold?"bold":"normal"),o.css("fontStyle",n.italic?"italic":"normal"),o.css("textDecoration",n.underline?"underline":"none"),o.css("color",n.forecolor),o.css("backgroundColor",n.backcolor),a.css("textAlign",n.align))}function r(n){return-1!==WIDGET_SETTINGS_UI_CONFIG.families.indexOf(n)?"standard":-1!==t.googleFontList.indexOf(n)?"google":"custom"}function f(){return t.fontData.font.url?t.fontData.font.url.split("/").pop().split(".")[0]:null}function m(n){var a=null,o=$.trim(t.fontData.font.url),e="font-family: "+n+"; src: url('"+o+"');";a=document.styleSheets[0],null!==a&&a.addRule("@font-face",e)}function d(t){t.addButton("aligntop",{image:"//s3.amazonaws.com/Rise-Images/Icons/align-top.svg",tooltip:"Align Top",onclick:function(){t.execCommand("mceToggleVertical",!1,"top")}}),t.addButton("alignmiddle",{image:"//s3.amazonaws.com/Rise-Images/Icons/align-vertical-middle.svg",tooltip:"Align Middle",onclick:function(){t.execCommand("mceToggleVertical",!1,"middle")}}),t.addButton("alignbottom",{image:"//s3.amazonaws.com/Rise-Images/Icons/align-bottom.svg",tooltip:"Align Bottom",onclick:function(){t.execCommand("mceToggleVertical",!1,"bottom")}}),t.addCommand("mceToggleVertical",function(){})}function u(t){switch(t){case"top":s(g.find(".mce-btn[aria-label='Align Top']"));break;case"middle":s(g.find(".mce-btn[aria-label='Align Middle']"));break;case"bottom":s(g.find(".mce-btn[aria-label='Align Bottom']"))}}var g=$(n),v=g.find(".custom-font"),b=g.find(".custom-font-size"),p=!0;t.googleFontList="",t.defaultFont={font:{family:"verdana,geneva,sans-serif",type:"standard",url:""},size:"24px",customSize:"",align:"left",verticalAlign:"middle",bold:!1,italic:!1,underline:!1,forecolor:"black",backcolor:"transparent"},o.getFonts().then(function(n){t.googleFontList=n}),t.customFontSize=null,t.applyCustomFont=function(){var n=f();null!==n&&(m(n),t.fontData.font.family=n,t.fontData.font.type="custom",c(t.fontData)),v.modal("hide")},t.applyCustomFontSize=function(){b.modal("hide"),null!==t.customFontSize&&t.customFontSize>=8&&t.customFontSize+"px"!==t.fontData.size&&(t.fontData.size=t.customFontSize+"px",-1!==WIDGET_SETTINGS_UI_CONFIG.sizes.indexOf(t.fontData.size)||t.fontData.customSize===t.fontData.size?a.tinymce.activeEditor.execCommand("FontSize",!1,t.fontData.size):(t.fontData.customSize=t.customFontSize+"px",t.tinymceOptions.fontsize_formats="Custom "+(""!==t.fontData.customSize?t.fontData.customSize+" ":"")+WIDGET_SETTINGS_UI_CONFIG.sizes)),t.customFontSize=null},t.defaults=function(t){if(t)for(var n=1,a=arguments.length;a>n;n++){var o=arguments[n];for(var e in o)void 0===t[e]&&(t[e]=o[e])}return t};var y=t.$watchGroup(["fontData","googleFontList"],function(n){var a=null,o=n[0],i=n[1];o&&i&&(t.defaults(o,t.defaultFont),t.fontData.font.url&&(a=f(),null!==a&&m(a)),c(o),e(),y(),t.previewText&&t.$watch("fontData",c,!0))});t.$watch("tinymceOptions.fontsize_formats",function(n){"undefined"==typeof n||p||t.$broadcast("$tinymce:refresh")})}}}])}(),function(){"use strict";angular.module("risevision.widget.common.font-setting").factory("googleFontLoader",["$http","angularLoad",function(t,n){var a="https://www.googleapis.com/webfonts/v1/webfonts?key=AIzaSyBXxVK_IOV7LNQMuVVo_l7ZvN53ejN86zY",o="//fonts.googleapis.com/css?family=",e=["Buda","Coda Caption","Open Sans Condensed","UnifrakturCook","Molle"],i=",sans-serif;",l={};return l.getFonts=function(){return t.get(a,{cache:!0}).then(function(t){var a="",l="",s=!1;if(t.data&&t.data.items)for(var c=0;c<t.data.items.length;c++)a=t.data.items[c].family,-1===e.indexOf(a)&&(n.loadCSS(o+a).then(function(){}),/\s/.test(a)&&(s=!0),l+=s?a+"='"+a+"'"+i:a+"="+a+i);return l})},l}])}(),function(t){try{t=angular.module("risevision.widget.common.font-setting")}catch(n){t=angular.module("risevision.widget.common.font-setting",[])}t.run(["$templateCache",function(t){"use strict";t.put("_angular/font-setting/font-setting.html",'<div class="font-setting">\n  <div class="row">\n    <div class="col-md-12">\n      <div ng-class="{\'form-group\': !previewText}">\n        <textarea ui-tinymce="tinymceOptions" ng-model="tinymceModel" ng-if="tinymceOptions"></textarea>\n      </div>\n    </div>\n  </div>\n  <div class="row" ng-if="previewText">\n    <div class="col-md-12">\n      <div class="text-container form-group">\n        <span class="text">{{previewText}}</span>\n      </div>\n    </div>\n  </div>\n\n  <!-- Custom Font -->\n  <div class="custom-font modal" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="false">\n    <div class="modal-dialog">\n      <div class="modal-content">\n\n        <div class="modal-header">\n          <button type="button" class="close" data-dismiss="modal">\n            <i class="fa fa-times half-top"></i>\n          </button>\n          <h2 class="modal-title">{{"font-setting.custom-font" | translate}}</h2>\n        </div>\n\n        <form role="form" name="customFontForm">\n          <div class="modal-body">\n            <url-field url="fontData.font.url" ng-model="customFont" init-empty></url-field>\n          </div>\n\n          <div class="modal-footer">\n            <button type="button" class="select btn btn-primary btn-fixed-width" ng-click="applyCustomFont()" ng-disabled="customFontForm.$invalid">\n              <span>{{"common.select" | translate}}</span>\n              <i class="fa fa-white fa-check icon-right"></i>\n            </button>\n            <button type="button" class="cancel btn btn-default btn-fixed-width" data-dismiss="modal">\n              <span>{{"common.cancel" | translate}}</span>\n              <i class="fa fa-white fa-times icon-right"></i>\n            </button>\n          </div>\n        </form>\n\n      </div>\n    </div>\n  </div>\n\n  <!-- Custom Font Size -->\n  <div class="custom-font-size modal" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="false">\n    <div class="modal-dialog">\n      <div class="modal-content">\n\n        <div class="modal-header">\n          <button type="button" class="close" data-dismiss="modal">\n            <i class="fa fa-times half-top"></i>\n          </button>\n          <h2 class="modal-title">{{"font-setting.custom-font-size" | translate}}</h2>\n        </div>\n\n        <form role="form" name="customFontSizeForm">\n          <div class="modal-body">\n            <div class="row">\n              <div class="col-md-3">\n                <div class="input-group">\n                  <input type="number" ng-model="customFontSize" class="form-control" />\n                  <span class="input-group-addon">{{\'common.units.pixels\' | translate}}</span>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class="modal-footer">\n            <button type="button" class="select btn btn-primary btn-fixed-width" ng-click="applyCustomFontSize()" ng-disabled="customFontSizeForm.$invalid">\n              <span>{{"common.select" | translate}}</span>\n              <i class="fa fa-white fa-check icon-right"></i>\n            </button>\n            <button type="button" class="cancel btn btn-default btn-fixed-width" data-dismiss="modal">\n              <span>{{"common.cancel" | translate}}</span>\n              <i class="fa fa-white fa-times icon-right"></i>\n            </button>\n          </div>\n        </form>\n\n      </div>\n    </div>\n  </div>\n</div>\n')}])}();