var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.LoggerUtils=function(e){"use strict";function n(e,n){Array.isArray(e)&&e.length>0&&Array.isArray(n)&&n.length>0&&("companyId"===e[0]&&(g=n[0]),"displayId"===e[1]&&(l=n[1]?n[1]:"preview"),f(g,l))}function t(e,n){var t=null;e.event?(t=e,t.file_url&&(t.file_format=s(t.file_url)),r(function(e,r){t.company_id=e,t.display_id=r,n(t)})):n(t)}function r(t){t&&"function"==typeof t&&(f=t,g&&l?f(g,l):u&&""!==u&&(e.rpc.register("rsparam_set_"+u,n),e.rpc.call("","rsparam_get",null,u,["companyId","displayId"])))}function s(e){var n,t=/[?#&]/;return e&&"string"==typeof e?(n=e.substr(e.lastIndexOf(".")+1),t.test(n)&&(n=n.substr(0,-1!==n.indexOf("?")?n.indexOf("?"):n.length),n=n.substr(0,-1!==n.indexOf("#")?n.indexOf("#"):n.length),n=n.substr(0,-1!==n.indexOf("&")?n.indexOf("&"):n.length)),n.toLowerCase()):null}function i(e){var n=JSON.parse(JSON.stringify(c));return n.rows[0].insertId=Math.random().toString(36).substr(2).toUpperCase(),n.rows[0].json=JSON.parse(JSON.stringify(e)),n.rows[0].json.ts=(new Date).toISOString(),n}function o(e){var n=new Date,t=n.getUTCFullYear(),r=n.getUTCMonth()+1,s=n.getUTCDate();return 10>r&&(r="0"+r),10>s&&(s="0"+s),e+t+r+s}function a(e,n){t(n,function(n){null!==n&&RiseVision.Common.Logger.log(e,n)})}var u=(new e.Prefs).getString("id"),l="",g="",f=null,c={kind:"bigquery#tableDataInsertAllRequest",skipInvalidRows:!1,ignoreUnknownValues:!1,rows:[{insertId:""}]};return{getIds:r,getInsertData:i,getFileFormat:s,getTable:o,logEvent:a}}(gadgets),RiseVision.Common.Logger=function(e){"use strict";function n(e){var n=new XMLHttpRequest;return new Date-l<358e4?e({}):(n.open("POST",s,!0),n.onloadend=function(){var t=JSON.parse(n.response);e({token:t.access_token,refreshedAt:new Date})},n.send(),void 0)}function t(e){return o&&u===e}function r(r,s){function f(n){var t,o,a=new XMLHttpRequest;o=i.replace("TABLE_ID",e.getTable(r)),l=n.refreshedAt||l,g=n.token||g,t=e.getInsertData(s),a.open("POST",o,!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Authorization","Bearer "+g),s.cb&&"function"==typeof s.cb&&(a.onloadend=function(){s.cb(a.response)}),a.send(JSON.stringify(t))}if(!(!r||!s||s.hasOwnProperty("event")&&!s.event||s.hasOwnProperty("event")&&t(s.event)))return o=!0,u=s.event,setTimeout(function(){o=!1},a),n(f)}var s="https://www.googleapis.com/oauth2/v3/token?client_id="+WIDGET_COMMON_CONFIG.LOGGER_CLIENT_ID+"&client_secret="+WIDGET_COMMON_CONFIG.LOGGER_CLIENT_SECRET+"&refresh_token="+WIDGET_COMMON_CONFIG.LOGGER_REFRESH_TOKEN+"&grant_type=refresh_token",i="https://www.googleapis.com/bigquery/v2/projects/client-side-events/datasets/Widget_Events/tables/TABLE_ID/insertAll",o=!1,a=1e3,u="",l=0,g="";return{log:r}}(RiseVision.Common.LoggerUtils);