var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.LoggerUtils=function(){"use strict";function e(e,n){var s=null;e.event?(s=e,s.file_url&&(s.file_format=t(s.file_url)),s.company_id=u,s.display_id=a,l&&(s.version=l),n(s)):n(s)}function n(){var e=new Date,n=e.getUTCFullYear(),t=e.getUTCMonth()+1,s=e.getUTCDate();return 10>t&&(t="0"+t),10>s&&(s="0"+s),n+t+s}function t(e){var n,t=/[?#&]/;return e&&"string"==typeof e?(n=e.substr(e.lastIndexOf(".")+1),t.test(n)&&(n=n.substr(0,-1!==n.indexOf("?")?n.indexOf("?"):n.length),n=n.substr(0,-1!==n.indexOf("#")?n.indexOf("#"):n.length),n=n.substr(0,-1!==n.indexOf("&")?n.indexOf("&"):n.length)),n.toLowerCase()):null}function s(e){var t={kind:"bigquery#tableDataInsertAllRequest",skipInvalidRows:!1,ignoreUnknownValues:!1,templateSuffix:n(),rows:[{insertId:""}]},s=JSON.parse(JSON.stringify(t));return s.rows[0].insertId=Math.random().toString(36).substr(2).toUpperCase(),s.rows[0].json=JSON.parse(JSON.stringify(e)),s.rows[0].json.ts=(new Date).toISOString(),s}function o(n,t){e(t,function(e){null!==e&&RiseVision.Common.Logger.log(n,e)})}function i(e,n){u=e,a=n}function r(e){l=e}var a="",u="",l=null;return{getInsertData:s,getFileFormat:t,logEvent:o,setIds:i,setVersion:r}}(),RiseVision.Common.Logger=function(e){"use strict";function n(e){var n=new XMLHttpRequest;return new Date-l<358e4?e({}):(n.open("POST",o,!0),n.onloadend=function(){var t=JSON.parse(n.response);e({token:t.access_token,refreshedAt:new Date})},n.send(),void 0)}function t(e){return r&&u===e}function s(s,o){function c(n){var t,r,a=new XMLHttpRequest;r=i.replace("TABLE_ID",s),l=n.refreshedAt||l,f=n.token||f,t=e.getInsertData(o),a.open("POST",r,!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Authorization","Bearer "+f),o.cb&&"function"==typeof o.cb&&(a.onloadend=function(){o.cb(a.response)}),a.send(JSON.stringify(t))}if(!(!s||!o||o.hasOwnProperty("event")&&!o.event||o.hasOwnProperty("event")&&t(o.event)))return r=!0,u=o.event,setTimeout(function(){r=!1},a),n(c)}var o="https://www.googleapis.com/oauth2/v3/token?client_id="+WIDGET_COMMON_CONFIG.LOGGER_CLIENT_ID+"&client_secret="+WIDGET_COMMON_CONFIG.LOGGER_CLIENT_SECRET+"&refresh_token="+WIDGET_COMMON_CONFIG.LOGGER_REFRESH_TOKEN+"&grant_type=refresh_token",i="https://www.googleapis.com/bigquery/v2/projects/client-side-events/datasets/Widget_Events/tables/TABLE_ID/insertAll",r=!1,a=1e3,u="",l=0,f="";return{log:s}}(RiseVision.Common.LoggerUtils);