!function(){"use strict";try{angular.module("risevision.common.config")}catch(t){angular.module("risevision.common.config",[])}angular.module("risevision.common.config").value("STORE_URL","https://store.risevision.com/").value("STORE_SERVER_URL","https://store-dot-rvaserver2.appspot.com/"),angular.module("risevision.widget.common.subscription-status.config",[]).value("IN_RVA_PATH","/product/productId/?up_id=iframeId&parent=parentUrl&inRVA=true&cid=companyId").value("ACCOUNT_PATH","/account?cid=companyId").value("PATH_URL","v1/company/companyId/product/status?pc=").value("AUTH_PATH_URL","v1/widget/auth?cid=companyId&pc=")}(),function(){"use strict";angular.module("risevision.widget.common.subscription-status",["risevision.common.config","risevision.widget.common.subscription-status.config","risevision.widget.common.subscription-status.service","risevision.widget.common","risevision.common.i18n","ngSanitize","ui.bootstrap"])}(),function(){"use strict";angular.module("risevision.widget.common.subscription-status").controller("StoreModalController",["$scope","$rootScope","$timeout","$modalInstance","$location","$sce","gadgetsApi","STORE_URL","IN_RVA_PATH","productId","companyId",function(t,s,n,i,e,o,r,a,u,c,p){var d=function(){var t=a+u.replace("productId",c).replace("companyId",p).replace("iframeId","store-modal-iframe").replace("parentUrl",encodeURIComponent(e.$$absUrl));return o.trustAsResourceUrl(t)};t.url=d();var l=function(){i.close()},m=function(){i.dismiss()},b=function(){r&&n(function(){r.rpc.register("rscmd_saveSettings",l),r.rpc.register("rscmd_closeSettings",m),r.rpc.setupReceiver("store-modal-iframe")})};b()}])}(),function(){"use strict";angular.module("risevision.widget.common.subscription-status").directive("appSubscriptionStatus",["$templateCache","$modal","subscriptionStatusService",function(t,s,n){return{restrict:"AE",require:"?ngModel",scope:{productId:"@",productCode:"@",companyId:"@",productPrice:"@"},template:t.get("app-subscription-status-template.html"),link:function(t,i,e,o){function r(){t.productCode&&t.productId&&t.companyId&&n.get(t.productCode,t.companyId).then(function(s){s&&(t.subscriptionStatus=s)},function(){})}t.subscriptionStatus={status:"N/A",statusCode:"na",subscribed:!1,expiry:null},t.$watch("companyId",function(){r()}),o&&t.$watch("subscriptionStatus",function(t){o.$setViewValue(t)}),t.$watch("showStoreModal",function(n){if(n){var i=s.open({templateUrl:"store-iframe-template.html",controller:"StoreModalController",size:"lg",resolve:{productId:function(){return t.productId},companyId:function(){return t.companyId}}});i.result.then(function(){r()},function(){r()}).finally(function(){t.showStoreModal=!1})}})}}}]).directive("ngDisableRightClick",function(){return function(t,s){s.bind("contextmenu",function(s){t.$apply(function(){s.preventDefault()})})}})}(),function(){"use strict";angular.module("risevision.widget.common.subscription-status").directive("subscriptionStatus",["$templateCache","$modal","subscriptionStatusService","$document","$compile","$rootScope","STORE_URL","ACCOUNT_PATH",function(t,s,n,i,e,o,r,a){return{restrict:"AE",require:"?ngModel",scope:{productId:"@",productCode:"@",companyId:"@",expandedFormat:"@",showStoreModal:"=?"},template:t.get("subscription-status-template.html"),link:function(t,i,e,u){function c(){t.productCode&&t.productId&&t.companyId&&n.get(t.productCode,t.companyId).then(function(s){s&&(t.subscriptionStatus&&t.subscriptionStatus.status===s.status||o.$emit("subscription-status:changed",s),t.subscriptionStatus=s)},function(){})}t.subscriptionStatus={status:"N/A",statusCode:"na",subscribed:!1,expiry:null};var p=function(){t.storeAccountUrl=r+a.replace("companyId",t.companyId)};t.$watch("companyId",function(){c(),p()}),o.$on("refreshSubscriptionStatus",function(s,n){(null===n||t.subscriptionStatus.statusCode===n)&&c()}),u&&t.$watch("subscriptionStatus",function(t){u.$setViewValue(t)}),t.$watch("showStoreModal",function(n){if(n){var i=s.open({templateUrl:"store-iframe-template.html",controller:"StoreModalController",size:"lg",resolve:{productId:function(){return t.productId},companyId:function(){return t.companyId}}});i.result.then(function(){c()},function(){c()}).finally(function(){t.showStoreModal=!1})}})}}}]).filter("to_trusted",["$sce",function(t){return function(s){return t.trustAsHtml(s)}}])}(),angular.module("risevision.widget.common.subscription-status").filter("productTrialDaysToExpiry",["$interpolate","$translate",function(t,s){var n=null,i=null;return s(["subscription-status.expires-today","subscription-status.expires-in"],{days:"{{days}}"}).then(function(s){n=t(s["subscription-status.expires-today"]),i=t(s["subscription-status.expires-in"])}),function(t){var s="";try{var e=864e5,o=new Date(t).getTime()-(new Date).getTime(),r=Math.floor(o/e),a={days:r};s=0===r?null!==n?n(a):"":r>0?null!==i?i(a):"":null!==n?n(a):""}catch(u){s=null!==n?n(a):""}return s}}]),function(){"use strict";angular.module("risevision.widget.common.subscription-status.service",["risevision.common.config","risevision.widget.common.subscription-status.config"]).service("subscriptionStatusService",["$http","$q","STORE_SERVER_URL","PATH_URL","AUTH_PATH_URL",function(t,s,n,i,e){function o(t,s){return Math.floor((s.getTime()-t.getTime())/u)}var r=["On Trial","Trial Expired","Subscribed","Suspended","Cancelled","Free","Not Subscribed","Product Not Found","Company Not Found","Error"],a=["on-trial","trial-expired","subscribed","suspended","cancelled","free","not-subscribed","product-not-found","company-not-found","error"],u=864e5,c=function(i,o){var r=s.defer(),a=n+e.replace("companyId",o)+i;return t.get(a).then(function(t){t&&t.data?r.resolve(t.data.authorized):r.resolve(!1)}),r.promise},p=function(e,u){var c=s.defer(),p=n+i.replace("companyId",u)+e;return t.get(p).then(function(t){if(t&&t.data&&t.data.length){var s=t.data[0];s.plural="";var n=r.indexOf(s.status);n>=0&&(s.statusCode=a[n]),""===s.status?(s.status="N/A",s.statusCode="na",s.subscribed=!1):s.subscribed=s.status===r[0]||s.status===r[2]||s.status===r[5]?!0:!1,"not-subscribed"===s.statusCode&&s.trialPeriod&&s.trialPeriod>0&&(s.statusCode="trial-available",s.subscribed=!0),s.expiry&&"on-trial"===s.statusCode&&(s.expiry=new Date(s.expiry),s.expiry instanceof Date&&!isNaN(s.expiry.valueOf())&&(s.expiry=o(new Date,s.expiry)),0===s.expiry?s.plural="-zero":s.expiry>1&&(s.plural="-many")),c.resolve(s)}else c.reject("No response")}),c.promise};this.get=function(t,s){return p(t,s).then(function(n){return n.subscribed===!1?c(t,s).then(function(t){return n.subscribed=t,n}):n})}}])}(),function(t){try{t=angular.module("risevision.widget.common.subscription-status")}catch(s){t=angular.module("risevision.widget.common.subscription-status",[])}t.run(["$templateCache",function(t){"use strict";t.put("app-subscription-status-template.html",'<a id="app-subscription-status" href=""\n  ng-click="showStoreModal = true" class="store-link">\n    <div class="rate">\n      <strong>${{productPrice}}</strong>\n    </div>\n    <div class="subscribe">\n      <strong ng-if="!subscriptionStatus.subscribed"><span translate="subscription-status.get-subscription"></span></strong>\n      <strong ng-if="subscriptionStatus.subscribed"><span translate="subscription-status.continue-to-app"></span></strong>\n    </div>\n</a>\n')}])}(),function(t){try{t=angular.module("risevision.widget.common.subscription-status")}catch(s){t=angular.module("risevision.widget.common.subscription-status",[])}t.run(["$templateCache",function(t){"use strict";t.put("store-iframe-template.html",'<iframe id="store-modal-iframe" name="store-modal-iframe" class="modal-dialog" scrolling="no" marginwidth="0" src="{{ url }}"></iframe>\n')}])}(),function(t){try{t=angular.module("risevision.widget.common.subscription-status")}catch(s){t=angular.module("risevision.widget.common.subscription-status",[])}t.run(["$templateCache",function(t){"use strict";t.put("subscription-status-template.html",'<div ng-show="!expandedFormat">\n  <h3 ng-disable-right-click>\n    <span ng-show="subscriptionStatus.statusCode !== \'not-subscribed\'" ng-bind-html="\'subscription-status.\' + subscriptionStatus.statusCode + subscriptionStatus.plural | translate:subscriptionStatus | to_trusted"></span>\n  </h3>\n  \n  <span ng-show="subscriptionStatus.statusCode === \'trial-available\'">\n    <button class="btn btn-primary btn-xs" ng-click="showStoreModal = true;">\n      <span translate="subscription-status.start-trial"></span>\n    </button>\n  </span>\n  <span ng-show="[\'on-trial\', \'trial-expired\', \'cancelled\', \'not-subscribed\'].indexOf(subscriptionStatus.statusCode) >= 0">\n    <button class="btn btn-primary btn-xs" ng-click="showStoreModal = true;">\n      <span translate="subscription-status.subscribe"></span>\n    </button>\n  </span>\n  <span ng-show="[\'suspended\'].indexOf(subscriptionStatus.statusCode) >= 0">\n    <a type="button" class="btn btn-primary btn-xs" ng-href="{{storeAccountUrl}}" target="_blank">\n      <span translate="subscription-status.view-account"></span>\n    </a>\n  </span>\n</div>\n\n<div ng-show="expandedFormat">\n  <div class="subscription-status trial" ng-show="subscriptionStatus.statusCode === \'on-trial\'">\n    <span ng-bind-html="\'subscription-status.expanded-\' + subscriptionStatus.statusCode + subscriptionStatus.plural | translate:subscriptionStatus | to_trusted"></span>\n    <button type="button" class="btn btn-primary add-left" ng-click="showStoreModal = true;">\n      <span translate="subscription-status.subscribe-now"></span>\n    </button>\n  </div>\n  <div class="subscription-status expired" ng-show="subscriptionStatus.statusCode === \'trial-expired\'">\n    <span translate="subscription-status.expanded-expired"></span>\n    <button type="button" class="btn btn-primary add-left" ng-click="showStoreModal = true;">\n      <span translate="subscription-status.subscribe-now"></span>\n    </button>\n  </div>\n  <div class="subscription-status cancelled" ng-show="subscriptionStatus.statusCode === \'cancelled\'">\n   <span translate="subscription-status.expanded-cancelled"></span>\n    <button type="button" class="btn btn-primary add-left" ng-click="showStoreModal = true;">\n      <span translate="subscription-status.subscribe-now"></span>\n    </button>\n  </div>\n  <div class="subscription-status suspended" ng-show="subscriptionStatus.statusCode === \'suspended\'">\n    <span translate="subscription-status.expanded-suspended"></span>\n    <a type="button" class="btn btn-primary add-left" ng-href="{{storeAccountUrl}}" target="_blank">\n      <span translate="subscription-status.view-invoices"></span>\n    </a>\n  </div>\n</div>\n')}])}();